{{ licenseTs }}
{%- set components = {
    'datepicker': False,
    'dict_type': False,
} %}

{%- for context in fields %}
    {%- set html_type = context.field.html_type %}
    {%- if html_type in components %}
        {%- set _ = components.update({html_type: True}) %}
    {%- endif %}
    {%- if context.field.dict_type != "" %}
        {%- set _ = components.update({'dict_type': True}) %}
    {%- endif %}
{%- endfor %}

{%- if components.datepicker %}
import dayjs from 'dayjs';
{%- endif %}
import {
  Descriptions,
  Drawer,
  Button,
  Space,
} from 'antd';
{%- if components.dict_type %}

{%- endif %}
import { {{ CN }}Detail } from '@/types/{{ c_kebab_n }}';
import React, { useMemo } from 'react';

interface {{ CN }}DetailDrawerProps {
  is{{ CN }}DetailDrawerVisible: boolean;
  on{{ CN }}DetailClose: () => void;
  {{ cN }}Detail: {{ CN }}Detail | undefined;
  loading: boolean
}

const {{ CN }}DetailComponent: React.FC<{{ CN }}DetailDrawerProps> = ({
  is{{ CN }}DetailDrawerVisible,
  on{{ CN }}DetailClose,
  {{ cN }}Detail,
  loading
}) => {

{%- if components.dict_type %}
  const dictData = {
    "key1": "value1",
    "key2": "value2"
}
{%- endif %}

  return (
    <Drawer
      title="{{ function_name }}详情"
      open={is{{ CN }}DetailDrawerVisible}
      onClose={on{{ CN }}DetailClose}
      destroyOnHidden
      loading={loading}
      width={600}
    >
      { {{ cN }}Detail && (
        <Descriptions column={1} bordered>
          {%- for context in fields %}
          {%- set comment = "" %}
          {%- if context.field.detailable == 1 and context.field.field_name != primary_key %}
          {%- if context.field.comment and context.field.comment != "" %}
              {%- set parentheseIndex_en = context.field.comment.find("(") %}
              {%- set parentheseIndex_cn = context.field.comment.find("（") %}
              {%- if parentheseIndex_en!= -1 %}
                  {%- set comment = context.field.comment[:parentheseIndex_en] %}
              {%- elif parentheseIndex_cn!= -1 %}
                  {%- set comment = context.field.comment[:parentheseIndex_cn] %}
              {%- else %}
                  {%- set comment = context.field.comment %}
              {%- endif %}
          {%- endif %}
          {%- set field_name = context.field.field_name %}
          {%- set html_type = context.field.html_type %}
          {%- set dict_type = context.field.dict_type %}
          <Descriptions.Item label="{% if comment %}{{ comment }}{% else %}{{ context.field.field_name }}{% endif %}">
            {%- if html_type == 'datepicker' or html_type == 'datetime' %}
              {dayjs({{ cN }}Detail.{{ field_name }}).format('YYYY-MM-DD')}
            {%- elif dict_type %}
              {(() => {
                const values = ({{ cN }}Detail.{{ field_name }} || '').toString().split(',');
                return values.map((value, index) => {
                  const item = dictData["{{ dict_type }}"] && dictData["{{ dict_type }}"].find((d: Record<string, string>) => d.value === value);
                  const content = item ? <span key={value}>{item.label}</span> : <span key={value}>-</span>;
                  return index < values.length - 1 ? (
                    <React.Fragment key={index}>
                      {content}
                      ,&nbsp;
                    </React.Fragment>
                  ) : content;
                });
              })()}
            {%- else %}
              { {{ cN }}Detail.{{ field_name }}}
            {%- endif %}
          </Descriptions.Item>
          {%- endif %}
          {%- endfor %}
        </Descriptions>
      )}
    </Drawer>
  );
};

export default {{ CN }}DetailComponent;
